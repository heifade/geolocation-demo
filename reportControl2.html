<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <style>
      body {
        font-size: 30px;
      }
      textarea {
        font-size: 30px;
      }
    </style>
  </head>
  <body>
    我是控件
    <textarea id="text1" style="width: 100%; height: 70%"></textarea>
    <script>
      var text1 = document.getElementById("text1");
      window.addEventListener(
        "message",
        function (e) {
          text1.value += "收到消息：" + JSON.stringify(e.data.data) + "\n";
        },
        false
      );

      window.onload = function send() {
        // window.top.postMessage(
        //   {
        //     type: "askForGeoLocation",
        //   },
        //   "*"
        // );

        navigator.geolocation.watchPosition(
          function (res) {
            let latitude = res.coords.latitude;
            let longitude = res.coords.longitude;

            const json = {
              type: "geolocation",
              data: {
                latitude,
                longitude,
              },
            };

            text1.value = "发送位置: " + JSON.stringify(json) + "\n";
          },
          function (e) {
            text1.value = "error:" + e.message + "\n";
          },
          {
            enableHighAccuracy: true,
          }
        );
      };
    </script>
  </body>
</html>
